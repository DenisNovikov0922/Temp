!function($){"use strict";var currentTour=!1,currentStep=!1,currentStepIndex=0,currentLinkIndex=0,isLinking=!1,wutb_mouseX,wutb_mouseY,wutb_linkGradientIndex=1,stepsCanvasTimer=!1,layoutPanel,tourModified=!1,iframeLoaded=!1,codeJSEditor=!1,wpMenuWasOpen=!1,selectUrlMode="step",wutb_selectedElement,selectionInProgress=!1;function elementSelected(){validElementSelection(wutb_selectedElement=$("body").data("wutb_selectedElement"))}function showFirstStartPanel(){0==$("#wutb_panelToursList tbody tr[data-tour]").length&&$("#wutb_panelFirstTour").addClass("wutb_visible")}function initGlobalListeners(){$("body").on("elementSelected",function(){validElementSelection(wutb_selectedElement)}),$("#wutb_exportLink").on("click",function(){$("#wutb_winExport").modal("hide")}),$("#adminmenu a, #wpadminbar a").on("click",function(){if(-1==$(this).attr("href").indexOf("javascript:")&&"#"!=$(this).attr("href")&&tourModified&&0==$("#notice_saveBeforeLeave").length)return askSaveBeforeLeave($(this).attr("href")),!1}),$(window).on("keydown",function(t){if(116==t.which&&tourModified&&0==$("#notice_saveBeforeLeave").length)return askSaveBeforeLeave(document.location.href),!1}),$("#wutb_elementSelectionFrame").on("load",function(){hideLoader(),iframeLoaded=!0,$("#wutb_frameLoader").fadeOut(),"selectPage"==$("#wutb_elementSelectionFrame").data("action")?(layoutPanel.closePanel($(".panel-bottom"),layoutPanel),startSelectUrl()):"selectStartElement"==$("#wutb_elementSelectionFrame").data("action")?($("#wutb_elementSelectionFrame").data("action",""),layoutPanel.closePanel($(".panel-bottom"),layoutPanel),startSelectElement()):currentStep&&0==$("#notice_startPageSelection").length&&0==$("#notice_startElementSelection").length&&(updateStepPreview(),$(".panel-right").removeClass("hidden"),layoutPanel.showPanel($(".panel-right"),layoutPanel))}),$('a[data-action="previewTourByID"]').on("click",function(){previewTourByID($(this).attr("data-tourid"))}),$('a[data-action="duplicateTour"]').on("click",function(){$.ajax({url:ajaxurl,type:"post",data:{action:"wutb_duplicateTour",tourID:$(this).attr("data-tourid")},success:function(t){editTour(t)}})}),$('a[data-action="exportTours"]').on("click",exportTours),$('a[data-action="importTours"]').on("click",importTours),$('a[data-action="importToursJson"]').on("click",importToursJson),$('a[data-action="openWinLicense"]').on("click",openWinLicense),$('a[data-action="verifyLicense"]').on("click",verifyLicense)}function onLayoutPanelChange(){}function initUI(){layoutPanel=$(".layout-panel:not(.wutb-initialized)").layoutPanel({leftWidth:340,rightWidth:340,topHeight:80,bottomHeight:340,onMinify:onLayoutPanelChange,onMaximize:onLayoutPanelChange,onUnMinify:onLayoutPanelChange,onUnMaximize:onLayoutPanelChange,onClose:onLayoutPanelChange}),$(".wutb .panel-body > .panel-tabs > a").on("click",function(){var t=$(this).attr("data-tab");$(this).parent().find(".active").removeClass("active"),$(this).addClass("active"),$(this).closest(".panel-tabs").parent().find("div[data-tab]").hide(),$(this).closest(".panel-tabs").parent().find('div[data-tab="'+t+'"]').show()}),$(".wutb .m_scrollbar").mCustomScrollbar({theme:"dark"}),$("#wutb_stepManagerPanel").contextmenu(function(){return!1}),layoutPanel=$(".layout-panel").data("layoutPanel"),$(document).mousemove(function(t){isLinking&&(wutb_mouseX=t.pageX-$("#wutb_stepsContainer").offset().left,wutb_mouseY=t.pageY-$("#wutb_stepsContainer").offset().top)}),$('[data-toggle="tooltip"],[data-tooltip]').each(function(){var t="";$(this).is("[data-tooltipcolor]")&&(t=$(this).attr("data-tooltipcolor"));var e="bottom";$(this).is("[data-placement]")&&(e=$(this).attr("data-placement")),$(this).tooltip({container:".wutb",placement:e,template:'<div class="tooltip '+e+'" data-color="'+t+'" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'})}),$(document).mousedown(function(t){return 2!=t.button||(isLinking=isLinking&&!1,!1)}),$(window).resize(function(){$("#wutb_loader .wutb_spinner").css({top:$(window).height()/2-$("#wpadminbar").height()/2}),$("#wutb_formPanel").css({minHeight:$("#wpwrap").height()})}),$("#wutb_formPanel").css({minHeight:$("#wpwrap").height()}),$(window).on("resize",function(){onResize()}),$('#wutb_panelFirstTour a[data-action="createTour"]').on("click",createTour),$('#wutb_tourListTable thead a[data-action="createTour"]').on("click",createTour),$('#wutb_panelToursList tbody a[data-action="deleteTour"]').on("click",function(){askDeleteTour($(this).closest("tr").attr("data-tour"))}),$('#wutb_panelToursList tbody a[data-action="editTour"]').on("click",function(){editTour($(this).closest("tr").attr("data-tour"))}),$('#wutb_winConditions [data-action="addConditionInteraction"]').on("click",function(){addConditionInteraction($("#wutb_winConditions"),!1)}),$('.panel-right [data-name="htmlText"]').summernote({height:226,toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["table"]],["insert",["link","picture","hr"]],["view",["codeview"]],["help",["help"]]],disableResizeEditor:!0,callbacks:{onChange:function(t,e){}}}),$('.panel-top [data-tab="tour"] a[data-action="preview"]').on("click",previewTour),stepsCanvasTimer=setInterval(updateStepCanvas,30)}function updateStepCanvas(){var p,t,e,n;0<$("#wutb_stepsCanvas").length&&(30<=++wutb_linkGradientIndex&&(wutb_linkGradientIndex=1),(p=$("#wutb_stepsCanvas").get(0).getContext("2d")).clearRect(0,0,$("#wutb_stepsCanvas").attr("width"),$("#wutb_stepsCanvas").attr("height")),$.each(currentTour.links,function(t){var e,n,a,o,i,r,l,s,u,c,d=this;d.destinationID&&0<$('.wutb_stepBloc[data-stepid="'+d.originID+'"]').length&&0<$('.wutb_stepBloc[data-stepid="'+d.destinationID+'"]').length?(e=parseInt($('.wutb_stepBloc[data-stepid="'+d.originID+'"]').css("left"))+$('.wutb_stepBloc[data-stepid="'+d.originID+'"]').outerWidth()/2+22,n=parseInt($('.wutb_stepBloc[data-stepid="'+d.originID+'"]').css("top"))+$('.wutb_stepBloc[data-stepid="'+d.originID+'"]').outerHeight()/2+22,a=parseInt($('.wutb_stepBloc[data-stepid="'+d.destinationID+'"]').css("left"))+$('.wutb_stepBloc[data-stepid="'+d.destinationID+'"]').outerWidth()/2+22,o=parseInt($('.wutb_stepBloc[data-stepid="'+d.destinationID+'"]').css("top"))+$('.wutb_stepBloc[data-stepid="'+d.destinationID+'"]').outerHeight()/2+22,i=p.createLinearGradient(e,n,a,o),s=.1+(l=r=wutb_linkGradientIndex/30),u=.2+r,p.lineWidth=2,1<s&&(s=0,u=.2),1<u&&(u=0),i.addColorStop(l,"#dddddd"),i.addColorStop(s,"#00adb5"),i.addColorStop(u,"#dddddd"),p.strokeStyle=i,p.setLineDash([10,10]),p.beginPath(),p.moveTo(e,n),p.lineTo(a,o),p.stroke(),0==$('.wutb_linkPoint[data-linkindex="'+t+'"]').length&&(c=$('<a href="javascript:" data-linkindex="'+t+'" class="wutb_linkPoint"><span class="fas fa-pencil-alt"></span></a>'),$("#wutb_stepsContainer").append(c),c.on("click",function(){openWinLink($(this))})),repositionLinkPoint(t)):$('.wutb_linkPoint[data-linkindex="'+t+'"]').remove()}),isLinking&&(e=(t=$('.wutb_stepBloc[data-stepid="'+currentTour.links[currentLinkIndex].originID+'"]')).position().left+$("#wutb_stepsOverflow").scrollLeft()+t.outerWidth()/2,n=t.position().top+$("#wutb_stepsOverflow").scrollTop()+t.outerHeight()/2,p.strokeStyle="#dddddd",p.lineWidth=2,p.setLineDash([10,10]),p.beginPath(),p.moveTo(e,n),p.lineTo(wutb_mouseX,wutb_mouseY),p.stroke()))}function getLinkByIndex(e){var n=!1;return $.each(currentTour.links,function(t){t==e&&(n=this)}),n}function openWinLink(t){currentLinkIndex=t.attr("data-linkindex"),$("#wutb_winConditions").attr("data-linkindex",t.attr("data-linkindex")),$("#wutb_winConditions #wutb_linkStepsPreview").html('<div id="wutb_linkOriginStep" class="wutb_stepBloc"><div class="wutb_stepBlocWrapper"><h4 id="wutb_linkOriginTitle" style="margin-top: 0px;"></h4></div> </div><div id="wutb_linkStepArrow"></div><div id="wutb_linkDestinationStep" class="wutb_stepBloc  "><div class="wutb_stepBlocWrapper"><h4 id="wutb_linkDestinationTitle" style="margin-top: 0px;"></h4></div></div>'),$(".wutb_conditionItem").remove();var e=getStepByID(currentTour.links[t.attr("data-linkindex")].originID),n=getStepByID(currentTour.links[t.attr("data-linkindex")].destinationID);$("#wutb_linkInteractions").show(),$("#wutb_linkOriginTitle").html(e.title),$("#wutb_linkDestinationTitle").html(n.title),$.each(currentTour.links[currentLinkIndex].conditions.conditions,function(){addConditionInteraction($("#wutb_winConditions"),this)}),$("#wutb_winConditions #wutb_conditionsOperator").val(currentTour.links[currentLinkIndex].conditions.operator),openWinConditions($("#wutb_winConditions"),function(t){getLinkByIndex(currentLinkIndex).conditions=t},function(){showLoader();var e=0;$('.wutb_linkPoint[data-linkindex="'+currentLinkIndex+'"]').remove(),$.each(currentTour.links,function(t){t==currentLinkIndex&&(e=this.id)}),currentTour.links=$.grep(currentTour.links,function(t){return t.id!=e}),hideLoader(),updateStepCanvas()}),setTimeout(updateStepsDesign,255)}function openWinConditions(e,n,t,a){$("#wutb_btnHeaderClose").fadeIn(),$("#wutb_btnHeaderClose").off("click.wutb_close"),$("#wutb_btnHeaderClose").on("click.wutb_close",function(){closeWin(e)}),e.find("#wutb_linkMainImg [data-type]").hide(),e.find('#wutb_linkMainImg [data-type="'+a+'"]').show(),e.find("#wutb_conditionsSaveBtn").off("click.wutb_save"),e.find(" #wutb_conditionsDelBtn").off("click.wutb_save"),e.find(" #wutb_conditionsSaveBtn").on("click.wutb_save",function(){tourModified=!0,e.fadeOut();var t={operator:e.find("#wutb_conditionsOperator").val(),conditions:new Array};e.find(".wutb_conditionItem").each(function(){$(this).find(".wutb_conditionSelect").val()&&""!=$(this).find(".wutb_conditionSelect").val()&&"s"!=$(this).find(".wutb_conditionSelect").val().substr(0,1)&&t.conditions.push({elementID:$(this).find(".wutb_conditionSelect").val(),component:$(this).find(".wutb_conditionSelect option:selected").attr("data-component"),action:$(this).find(".wutb_conditionoperatorSelect").val(),value:$(this).find(".wutb_conditionValue").val()})}),n(t)}),null!=t?e.find("#wutb_conditionsDelBtn").on("click",function(){tourModified=!0,e.fadeOut(),t()}):e.find("#wutb_conditionsDelBtn").hide(),e.fadeIn(250)}function repositionLinkPoint(e){var n=currentTour.links[e],t=$('.wutb_stepBloc[data-stepid="'+n.originID+'"]').offset().left-$("#wutb_stepsContainer").offset().left+$('.wutb_stepBloc[data-stepid="'+n.originID+'"]').width()/2,a=$('.wutb_stepBloc[data-stepid="'+n.originID+'"]').offset().top-$("#wutb_stepsContainer").offset().top+$('.wutb_stepBloc[data-stepid="'+n.originID+'"]').height()/2,o=$('.wutb_stepBloc[data-stepid="'+n.destinationID+'"]').offset().left-$("#wutb_stepsContainer").offset().left+$('.wutb_stepBloc[data-stepid="'+n.destinationID+'"]').width()/2,i=$('.wutb_stepBloc[data-stepid="'+n.destinationID+'"]').offset().top-$("#wutb_stepsContainer").offset().top+$('.wutb_stepBloc[data-stepid="'+n.destinationID+'"]').height()/2,r=t+(o-t)/2,l=a+(i-a)/2;$.each(currentTour.links,function(t){this.originID==n.destinationID&&this.destinationID==n.originID&&t<e&&(r+=15,l+=15)}),$('.wutb_linkPoint[data-linkindex="'+e+'"]').css({left:r+"px",top:l+"px"})}function onResize(){updateStepsDesign()}function createTour(){showLoader(),$('#wutb_tourListTable thead a[data-action="createTour"]').is(".disabled")||($("#wutb_panelFirstTour").removeClass("wutb_visible"),$('#wutb_tourListTable thead a[data-action="createTour"]').addClass("disabled"),$.ajax({url:ajaxurl,type:"post",data:{action:"wutb_createTour"},success:function(t){editTour(t)}}))}function editTour(tourID){$.ajax({url:ajaxurl,type:"post",data:{action:"wutb_editTour",tourID:tourID},success:function(tour){hideLoader(),$('[data-info="tourID"]').html(tourID),currentTour=JSON.parse(tour),$('#wutb_bottomSettings a[data-tab="settings"]').trigger("click"),$("#wutb_bottomSettings [name]").each(function(){var value;$(this).is('[type="checkbox"]')?(value=0,eval("value = currentTour.settings."+$(this).attr("name")+";"),value?$(this).attr("checked","checked"):$(this).removeAttr("checked")):$(this).is("select[multiple]")?eval("$(this).val(currentTour.settings."+$(this).attr("name")+'.split(","));'):eval("$(this).val(currentTour.settings."+$(this).attr("name")+");")}),$("#wutb_bottomSettings [name]").trigger("change"),$(".panel-center .panel-body").mCustomScrollbar("scrollTo","top");for(var i=0;i<currentTour.steps.length;i++)addStepToManager(currentTour.steps[i]);$("#wutb_stepManagerPanel").fadeIn(),setTimeout(function(){$("#wutb_panelToursList").hide()},380),$(".panel-top .panel-header > .panel-header-title > [data-tab] ").hide(),$('.panel-top .panel-header > .panel-header-title > [data-tab="tour"]').show(),$(".panel-top,.panel-bottom").removeClass("hidden"),setTimeout(function(){$(window).trigger("resize"),updateStepsDesign()},360)}})}function deleteTour(t){$.ajax({url:ajaxurl,type:"post",data:{action:"wutb_deleteTour",tourID:t},success:function(){$('#wutb_panelToursList tbody tr[data-tour="'+t+'"]').remove(),0==$("#wutb_panelToursList tbody tr[data-tour]").length&&$("#wutb_panelFirstTour").addClass("wutb_visible")}})}function initSettingsListeners(){$('#wutb_bottomSettings [data-action="startSelectStartURL"]').on("click",function(){$("#wutb_elementSelectionPanel").fadeIn(),selectUrlMode="tour",$("#wutb_elementSelectionFrame").data("action","selectPage");var t=wutb_data.siteUrl;$("#wutb_frameLoader").fadeIn(),$("#wutb_elementSelectionFrame").attr("src",t)}),$('#wutb_bottomSettings [data-action="startSelectElement"]').on("click",function(){$("#wutb_elementSelectionPanel").fadeIn(),$("#wutb_elementSelectionFrame").data("action","selectStartElement"),$("#wutb_frameLoader").fadeIn(),$("#wutb_elementSelectionFrame").attr("src",wutb_data.websiteUrl)}),$('#wutb_bottomSettings [name="startMethod"]').on("change",function(){"elementClick"==$(this).val()?$('#wutb_bottomSettings [name="tourDomElement"]').closest(".form-group").slideDown():$('#wutb_bottomSettings [name="tourDomElement"]').closest(".form-group").slideUp()}),$("#wutb_bottomSettings input[data-colorpicker]").each(function(){jQuery(this).colpick({color:"#FFFFFF",layout:"hex",appendTo:$("#wutb_bottomSettings .mCSB_container").get(0),onSubmit:function(){jQuery("body > .colpick").fadeOut()},onChange:function(t,e,n,a,o){jQuery(a).val("#"+e)}})}),$('#wutb_bottomSettings [name="startURL"]').on("change",function(){$(this).val($(this).val().replace(wutb_data.siteUrl,""))}),$("#wutb_bottomSettings a[data-tab]").on("click",function(){var t=$(this).attr("data-tab");$('#wutb_bottomSettings div[data-tab]:not([data-tab="'+t+'"])').hide(),$('#wutb_bottomSettings div[data-tab][data-tab="'+t+'"]').show(),$("#wutb_bottomSettings a[data-tab].active").removeClass("active"),$(this).addClass("active")}),$("#wutb_bottomSettings input[data-slider]").each(function(){$(this).after('<div class="wutb_slider"></div>');var t=0,e=99,n=1;$(this).is("[min]")&&(t=parseInt($(this).attr("min"))),$(this).is("[max]")&&(e=parseInt($(this).attr("max"))),$(this).is("[data-step]")&&(n=parseFloat($(this).attr("data-step"))),$(this).next(".wutb_slider").slider({min:t,max:e,step:n,change:function(t,e){$(this).find(".tooltip .tooltip-inner").html(e.value),$(this).prev("input[data-slider]").val(e.value)},slide:function(t,e){$(this).find(".tooltip .tooltip-inner").html(e.value),$(this).prev("input[data-slider]").val(e.value)}}),$(this).next(".wutb_slider").find(".ui-slider-handle").append('<div class="tooltip bs-tooltip-bottom" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'),$(this).next(".wutb_slider").attr("data-name",$(this).attr("name")),$(this).on("change",function(){$(this).next(".wutb_slider").slider("value",$(this).val())})}),$("#wutb_bottomSettings [name]").on("change focusout",function(){var value="",value=$(this).is('[type="checkbox"]')?$(this).is(":checked"):nl2br($(this).val());eval("currentTour.settings."+$(this).attr("name")+"=value;")}),$('#wutb_bottomSettings [name="showNavbar"]').on("change click",function(){$(this).is(":checked")?($('#wutb_bottomSettings [name="navbar_txtStopTour"]').closest(".form-group").slideDown(),$('#wutb_bottomSettings [name="navbar_txtNextStep"]').closest(".form-group").slideDown(),$('#wutb_bottomSettings [name="navbar_txtPreviousStep"]').closest(".form-group").slideDown()):($('#wutb_bottomSettings [name="navbar_txtStopTour"]').closest(".form-group").slideUp(),$('#wutb_bottomSettings [name="navbar_txtNextStep"]').closest(".form-group").slideUp(),$('#wutb_bottomSettings [name="navbar_txtPreviousStep"]').closest(".form-group").slideUp())}),$('#wutb_bottomSettings [name="allowedRoles"]').on("change",function(){$('#wutb_bottomSettings [name="allowedRoles"] option[value=""]').is(":selected")&&$('#wutb_bottomSettings [name="allowedRoles"]').val("")})}function initMenusListeners(){$('.panel-top a[data-action="closeStep"]').on("click",closeStepEdition),$('.panel-top a[data-action="saveTour"]').on("click",saveTour),$('.panel-top a[data-action="addStep"]').on("click",function(){var t=!1;0==currentTour.steps.length&&(t=!0);var e={id:generateID(),tourID:currentTour.id,position:[200,80],start:t,content:"",buttons:new Array,settings:{title:wutb_data.texts["New step"],type:"text",text:"Hello world !",headerText:wutb_data.texts["My title"],textStyle:"arrow",textColor:currentTour.settings.texts_textColor,textSize:currentTour.settings.texts_textSize,headerTextSize:currentTour.settings.texts_headerTextSize,position:"down",continueAction:"delay",continueDelay:6,useOverlay:!0,overlayOpacity:currentTour.settings.overlayOpacity,overlayColor:currentTour.settings.overlayColor,startDelay:0,backgroundColor:"#bdc3c7",headerColor:"#1abc9c",headerTextColor:currentTour.settings.texts_headerTextColor,footerColor:"#ccc",animation:"heartBeat",entryAnimation:"fadeIn",url:"",codeJS:"",offsetX:0,offsetY:0}};currentTour.steps.push(e),addStepToManager(e),linkLightStep(e.id)})}function nl2br(t,e){return null==t?"":(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+(e||void 0===e?"<br />":"<br>")+"$2")}function initStepSettings(){$(".panel-right input[data-slider]").each(function(){var n=this;$(this).after('<div class="wutb_slider"></div>');var t=0,e=99,a=1;$(this).is("[min]")&&(t=parseInt($(this).attr("min"))),$(this).is("[max]")&&(e=parseInt($(this).attr("max"))),$(this).is("[data-step]")&&(a=parseFloat($(this).attr("data-step"))),$(this).next(".wutb_slider").slider({min:t,max:e,step:a,change:function(t,e){$(this).find(".tooltip .tooltip-inner").html(e.value),$(this).prev("input[data-slider]").val(e.value),updateStepSetting($(this))},slide:function(t,e){$(this).find(".tooltip .tooltip-inner").html(e.value),$(this).prev("input[data-slider]").val(e.value),updateStepSetting($(n))}}),$(this).next(".wutb_slider").find(".ui-slider-handle").append('<div class="tooltip bs-tooltip-bottom" role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'),$(this).next(".wutb_slider").attr("data-name",$(this).attr("name")),$(this).on("change",function(){$(this).next(".wutb_slider").slider("value",$(this).val())})}),$(".panel-right input[data-colorpicker]").each(function(){jQuery(this).colpick({color:"#FFFFFF",layout:"hex",appendTo:$(".panel-right .mCSB_container").get(0),onSubmit:function(){jQuery("body > .colpick").fadeOut()},onChange:function(t,e,n,a,o){jQuery(a).val("#"+e),updateStepSetting($(a))}})}),$(".panel-right [name]:not([data-dontrefresh])").on("change keyup",updateEditedStepData),$('.panel-right [name="type"],.panel-right [name="textStyle"]').on("change keyup",updateStepPreview),$('.panel-right [name]:not([data-dontrefresh]):not([name="textStyle"])').on("change keyup",function(){updateStepSetting($(this))}),codeJSEditor=CodeMirror.fromTextArea($("#wutb_codeJSEditor").get(0),{lineNumbers:!0})}function initButtonListeners(){$('#wutb_winEditButton [name="action"]').on("change",function(){"stopTour"==$(this).val()?$('#wutb_winEditButton [name="finalPage"]').closest(".form-group").slideDown():$('#wutb_winEditButton [name="finalPage"]').closest(".form-group").slideUp()}),$('#wutb_winEditButton [data-action="saveButton"]').on("click",saveButton),$("#wutb_winEditButton input[data-colorpicker]").each(function(){jQuery(this).colpick({color:"#FFFFFF",layout:"hex",appendTo:$("#wutb_winEditButton .modal-content").get(0),onSubmit:function(){$("#wutb_winEditButton .modal-body").get(0),jQuery("body > .colpick").fadeOut()},onChange:function(t,e,n,a,o){jQuery(a).val("#"+e),updateStepPreview()}})})}function initStepListeners(){$('.panel-right [data-action="startSelectUrl"]').on("click",function(){selectUrlMode="step",startSelectUrl()}),$('.panel-right [data-action="startSelectElement"]').on("click",startSelectElement),$('.panel-right [name="url"]').on("change",function(){var t=$(this).val().replace(wutb_data.siteUrl,"");t=(t=t.replace("?stepPreview="+currentStep.id,"")).replace("&stepPreview="+currentStep.id,""),$(this).val(t),0==$("#notice_startPageSelection").length&&0==$("#notice_startElementSelection").length&&updateStepPreview()}),$('.panel-right [name="continueAction"]').on("change",function(t){"redirection"==currentStep.settings.type||"click"==$(this).val()?$('.panel-right [name="continueDelay"]').closest(".form-group").slideUp():$('.panel-right [name="continueDelay"]').closest(".form-group").slideDown()}),$('.panel-right [name="useOverlay"]').on("change",function(){$('.panel-right [name="useOverlay"]').is(":checked")?($('.panel-right [name="overlayOpacity"]').closest(".form-group").slideDown(),$('.panel-right [name="overlayColor"]').closest(".form-group").slideDown()):($('.panel-right [name="overlayOpacity"]').closest(".form-group").slideUp(),$('.panel-right [name="overlayColor"]').closest(".form-group").slideUp())}),$('.panel-right [name="textStyle"]').on("change",function(t){"dialog"==$('.panel-right [name="type"]').val()||"showElement"==$('.panel-right [name="type"]').val()&&"tooltip"==$(this).val()?$('.panel-right [name="backgroundColor"]').closest(".form-group").slideDown():$('.panel-right [name="backgroundColor"]').closest(".form-group").slideUp(),void 0===t.isTrigger&&"showElement"==$('.panel-right [name="type"]').val()&&("tooltip"==$(this).val()?($('.panel-right [name="backgroundColor"]').val(currentTour.settings.tooltip_backgroundColor).trigger("change"),$('.panel-right [name="textColor"]').val(currentTour.settings.tooltip_textColor).trigger("change"),$('.panel-right [name="textSize"]').val(currentTour.settings.tooltip_textSize).trigger("change")):"arrow"==$(this).val()&&($('.panel-right [name="textColor"]').val(currentTour.settings.arrow_textColor).trigger("change"),$('.panel-right [name="textSize"]').val(currentTour.settings.arrow_textSize).trigger("change")),setTimeout(function(){updateStepSetting($('.panel-right [name="type"]'))},800))}),$('.panel-right [name="type"]').on("change",function(t){void 0===t.isTrigger&&("dialog"==$(this).val()?($('.panel-right [name="headerTextColor"]').val(currentTour.settings.dialog_headerTextColor).trigger("change"),$('.panel-right [name="textColor"]').val(currentTour.settings.dialog_textColor).trigger("change"),$('.panel-right [name="headerColor"]').val(currentTour.settings.dialog_headerColor).trigger("change"),$('.panel-right [name="footerColor"]').val(currentTour.settings.dialog_footerColor).trigger("change"),$('.panel-right [name="backgroundColor"]').val(currentTour.settings.dialog_backgroundColor).trigger("change"),$('.panel-right [name="backgroundColor"]').closest(".form-group").slideDown()):"showElement"==$(this).val()?($('.panel-right [name="textStyle"]').val("arrow"),$('.panel-right [name="textColor"]').val(currentTour.settings.arrow_textColor).trigger("change"),$('.panel-right [name="textSize"]').val(currentTour.settings.arrow_textSize).trigger("change"),"tooltip"==$('.panel-right [name="textStyle"]').val()?$('.panel-right [name="backgroundColor"]').closest(".form-group").slideDown():$('.panel-right [name="backgroundColor"]').closest(".form-group").slideUp()):"text"==$(this).val()&&($('.panel-right [name="textColor"]').val(currentTour.settings.texts_textColor).trigger("change"),$('.panel-right [name="textSize"]').val(currentTour.settings.texts_textSize).trigger("change"),$('.panel-right [name="headerTextSize"]').val(currentTour.settings.texts_headerTextSize).trigger("change"),$('.panel-right [name="headerTextColor"]').val(currentTour.settings.texts_headerTextColor).trigger("change"),$('.panel-right [name="backgroundColor"]').closest(".form-group").slideUp()))}),$('.panel-right [name="type"]').on("change",function(){"dialog"==$(this).val()?($('.panel-right a[data-tab="style"]').show(),$('.panel-right [name="domElement"]').closest(".form-group").slideUp(),$('.panel-right [name="textStyle"]').closest(".form-group").slideUp(),$('.panel-right [name="codeJS"]').closest(".form-group").slideUp(),$('.panel-right [name="continueDelay"]').closest(".form-group").slideUp(),$('.panel-right [name="continueAction"]').closest(".form-group").slideUp(),$('.panel-right [name="continueDelay"]').closest(".form-group").slideUp(),$('.panel-right [name="position"]').closest(".form-group").slideUp(),$('.panel-right [name="headerTextSize"]').closest(".form-group").slideUp(),$('.panel-right [name="offsetX"]').closest(".form-group").slideUp(),$('.panel-right [name="offsetY"]').closest(".form-group").slideUp(),$('.panel-right [name="text"]').closest(".form-group").slideDown(),$('.panel-right [name="useOverlay"]').closest(".form-group").slideDown(),$('.panel-right [name="headerText"]').closest(".form-group").slideDown(),$('.panel-right [name="headerTextColor"]').closest(".form-group").slideDown(),$('.panel-right [name="footerColor"]').closest(".form-group").slideDown(),$('.panel-right [name="headerColor"]').closest(".form-group").slideDown(),$('.panel-right [name="startDelay"]').closest(".form-group").slideDown(),$('.panel-right [name="entryAnimation"]').closest(".form-group").slideDown(),$('.panel-right a[data-tab="buttons"]').fadeIn()):"showElement"==$(this).val()?($('.panel-right a[data-tab="style"]').show(),$('.panel-right [name="headerText"]').closest(".form-group").slideUp(),$('.panel-right [name="codeJS"]').closest(".form-group").slideUp(),$('.panel-right [name="headerTextColor"]').closest(".form-group").slideUp(),$('.panel-right [name="footerColor"]').closest(".form-group").slideUp(),$('.panel-right [name="headerColor"]').closest(".form-group").slideUp(),$('.panel-right [name="entryAnimation"]').closest(".form-group").slideUp(),$('.panel-right [name="headerTextSize"]').closest(".form-group").slideUp(),$('.panel-right [data-tab="buttons"]').fadeOut(),$('.panel-right [name="offsetX"]').closest(".form-group").slideDown(),$('.panel-right [name="offsetY"]').closest(".form-group").slideDown(),$('.panel-right [name="animation"]').closest(".form-group").slideDown(),$('.panel-right [name="domElement"]').closest(".form-group").slideDown(),$('.panel-right [name="textStyle"]').closest(".form-group").slideDown(),$('.panel-right [name="text"]').closest(".form-group").slideDown(),$('.panel-right [name="continueAction"]').closest(".form-group").slideDown(),$('.panel-right [name="continueDelay"]').closest(".form-group").slideDown(),$('.panel-right [name="useOverlay"]').closest(".form-group").slideDown(),$('.panel-right [name="overlayOpacity"]').closest(".form-group").slideDown(),$('.panel-right [name="overlayColor"]').closest(".form-group").slideDown(),$('.panel-right [name="position"]').closest(".form-group").slideDown(),$('.panel-right [name="startDelay"]').closest(".form-group").slideDown(),""==$('.panel-right [name="domElement"]').val()&&startSelectElement(),$('.panel-right [name="textStyle"]').trigger("change")):"text"==$(this).val()?($('.panel-right a[data-tab="style"]').show(),$('.panel-right [name="continueAction"]').closest(".form-group").slideUp(),$('.panel-right [name="codeJS"]').closest(".form-group").slideUp(),$('.panel-right [name="footerColor"]').closest(".form-group").slideUp(),$('.panel-right [name="headerColor"]').closest(".form-group").slideUp(),$('.panel-right [name="domElement"]').closest(".form-group").slideUp(),$('.panel-right [name="textStyle"]').closest(".form-group").slideUp(),$('.panel-right [name="animation"]').closest(".form-group").slideUp(),$('.panel-right [name="position"]').closest(".form-group").slideUp(),$('.panel-right [name="offsetX"]').closest(".form-group").slideUp(),$('.panel-right [name="offsetY"]').closest(".form-group").slideUp(),$('.panel-right [data-tab="buttons"]').fadeOut(),$('.panel-right [name="text"]').closest(".form-group").slideDown(),$('.panel-right [name="headerText"]').closest(".form-group").slideDown(),$('.panel-right [name="entryAnimation"]').closest(".form-group").slideDown(),$('.panel-right [name="continueDelay"]').closest(".form-group").slideDown(),$('.panel-right [name="useOverlay"]').closest(".form-group").slideDown(),$('.panel-right [name="overlayOpacity"]').closest(".form-group").slideDown(),$('.panel-right [name="overlayColor"]').closest(".form-group").slideDown(),$('.panel-right [name="headerText"]').closest(".form-group").slideDown(),$('.panel-right [name="headerTextColor"]').closest(".form-group").slideDown(),$('.panel-right [name="headerTextSize"]').closest(".form-group").slideDown(),$('.panel-right [name="startDelay"]').closest(".form-group").slideDown()):"executeJS"==$(this).val()?($('.panel-right [name="useOverlay"]').removeAttr("checked"),$('.panel-right a[data-tab="style"]').hide(),$('.panel-right a[data-tab="buttons"]').hide(),$('.panel-right [name="continueAction"]').closest(".form-group").slideUp(),$('.panel-right [name="domElement"]').closest(".form-group").slideUp(),$('.panel-right [name="text"]').closest(".form-group").slideUp(),$('.panel-right [name="headerText"]').closest(".form-group").slideUp(),$('.panel-right [name="headerTextSize"]').closest(".form-group").slideUp(),$('.panel-right [name="continueDelay"]').closest(".form-group").slideDown(),$('.panel-right [name="startDelay"]').closest(".form-group").slideDown(),$('.panel-right [name="codeJS"]').closest(".form-group").slideDown(),$('.panel-right [name="url"]').closest(".form-group").slideDown()):"redirection"==$(this).val()&&($('.panel-right [name="useOverlay"]').removeAttr("checked"),$('.panel-right a[data-tab="style"]').hide(),$('.panel-right a[data-tab="buttons"]').hide(),$('.panel-right [name="continueAction"]').closest(".form-group").slideUp(),$('.panel-right [name="domElement"]').closest(".form-group").slideUp(),$('.panel-right [name="text"]').closest(".form-group").slideUp(),$('.panel-right [name="headerText"]').closest(".form-group").slideUp(),$('.panel-right [name="headerTextSize"]').closest(".form-group").slideUp(),$('.panel-right [name="continueDelay"]').closest(".form-group").slideUp(),$('.panel-right [name="codeJS"]').closest(".form-group").slideUp(),$('.panel-right [name="startDelay"]').closest(".form-group").slideDown(),$('.panel-right [name="url"]').closest(".form-group").slideDown())}),$('.panel-right [data-tab="buttons"] a[data-action="createButton"]').on("click",createNewButton)}function addStepToManager(t){var e=$('<div class="wutb_stepBloc"><div class="wutb_stepBlocWrapper"><h4>'+t.settings.title+'</h4></div><a href="javascript:" class="wutb_btnEdit" title="'+wutb_data.texts.tip_editStep+'"><span class="fas fa-pencil-alt"></span></a><a href="javascript:" class="wutb_btnSup" title="'+wutb_data.texts.tip_delStep+'"><span class="fas fa-trash"></span></a><a href="javascript:" class="wutb_btnDup" title="'+wutb_data.texts.tip_duplicateStep+'"><span class="fas fa-copy"></span></a><a href="javascript:" class="wutb_btnLink" title="'+wutb_data.texts.tip_linkStep+'"><span class="fas fa-link"></span></a><a href="javascript:" class="wutb_btnStart" title="'+wutb_data.texts.tip_flagStep+'"><span class="fas fa-flag"></span></a></div>');t.start&&(e.find(".wutb_btnStart").addClass("wutb_selected"),e.addClass("wutb_selected")),t.elementID?e.attr("id",t.elementID):e.uniqueId(),e.children("a[title]").tooltip({container:".wutb",placement:"bottom",template:'<div class="tooltip bottom"  role="tooltip"><div class="arrow"></div><div class="tooltip-inner"></div></div>'}),e.children("a.wutb_btnEdit").on("click",function(){$("#wutb_mainPanel > .tooltip").remove(),editStep($(this).parent().attr("data-stepid"))}),e.children("a.wutb_btnLink").on("click",function(){$("#wutb_mainPanel > .tooltip").remove(),startLink($(this).parent().attr("data-stepid"))}),e.children("a.wutb_btnSup").on("click",function(){$("#wutb_mainPanel > .tooltip").remove(),askDeleteStep($(this).parent().attr("data-stepid"))}),e.children("a.wutb_btnDup").on("click",function(){$("#wutb_mainPanel > .tooltip").remove(),duplicateStep($(this).parent().attr("data-stepid"))}),e.children("a.wutb_btnStart").on("click",function(){$("#wutb_mainPanel > .tooltip").remove(),$(".wutb_stepBloc").removeClass("wutb_selected"),$(".wutb_btnStart").removeClass("wutb_selected"),$(this).addClass("wutb_selected"),$(this).closest(".wutb_stepBloc").addClass("wutb_selected");for(var t=0;t<currentTour.steps.length;t++)currentTour.steps[t].start=!1;getStepByID(parseInt($(this).parent().attr("data-stepid"))).start=!0}),e.draggable({containment:"parent",handle:".wutb_stepBlocWrapper",stop:function(t,e){var n=getStepByID(e.helper.attr("data-stepid"));n&&(n.position=[e.position.left,e.position.top])}}),e.children(".wutb_stepBlocWrapper").on("click",function(){isLinking&&stopLink(e)});var n=80,a=80,a=t.position?(n=t.position[0],t.position[1]):(n=$("#wutb_stepsOverflow").scrollLeft()+$("#wutb_stepsOverflow").width()/2-64,$("#wutb_stepsOverflow").scrollTop()+$("#wutb_stepsOverflow").height()/2-64);e.hide(),$("#wutb_stepsContainer").append(e),e.css({left:n+"px",top:a+"px"}),e.fadeIn(),setTimeout(updateStepsDesign,250),$(".wutb_btnWinClose").parent().on("click",function(){closeWin($(this).parents(".wutb_window"))}),e.attr("data-stepid",t.id)}function closeWin(t){t.fadeOut(),$("#wutb_btnHeaderClose").unbind("wutb_close"),$("#wutb_btnHeaderClose").fadeOut(),setTimeout(function(){updateStepsDesign()},250)}function duplicateStep(t){var e,n=getStepByID(t);n&&((e=JSON.parse(JSON.stringify(n))).id=generateID(),e.settings.title+=" (1)",e.start=!1,e.position=[e.position[0]+100,e.position[1]],currentTour.steps.push(e),addStepToManager(e))}function startLink(t){isLinking=!0,currentLinkIndex=currentTour.links.length,currentTour.links.push({originID:t,destinationID:null,conditions:[]})}function stopLink(t){var e=isLinking=!1;t.attr("data-stepid")!=currentTour.links[currentLinkIndex].originID&&($.each(currentTour.links,function(){this.originID==currentTour.links[currentLinkIndex].originID&&this.destinationID==t.attr("data-stepid")&&(e=this)}),e?currentTour.links=$.grep(currentTour.links,function(t){return t!=e}):(currentTour.links[currentLinkIndex].destinationID=t.attr("data-stepid"),currentTour.links[currentLinkIndex].id=generateID(),tourModified=!0))}function removeStep(e){tourModified=!0;$('.wutb_stepBloc[data-stepid="'+e+'"]').remove(),currentTour.steps=jQuery.grep(currentTour.steps,function(t){return t.id!=e})}function editStep(stepID){if(currentStep=getStepByID(stepID),0!=currentStep){iframeLoaded=!1;var targetUrl=wutb_data.websiteUrl;""!=currentStep.settings.url&&(targetUrl+=currentStep.settings.url),-1<targetUrl.indexOf("?")?targetUrl+="&stepPreview="+stepID:targetUrl+="?stepPreview="+stepID,$("#wutb_frameLoader").fadeIn(),$("#wutb_elementSelectionFrame").attr("src",targetUrl),$("#wutb_elementSelectionPanel").fadeIn(),$(".panel-center .panel-body").mCustomScrollbar("scrollTo","top"),$(".panel-top .panel-header >.panel-header-title >  [data-tab]").hide(),$('.panel-top .panel-header >.panel-header-title >  [data-tab="step"]').show(),$(".panel-bottom").addClass("hidden"),$(".panel-top").removeClass("hidden"),setTimeout(function(){$("#wutb_stepManagerPanel").hide()},380),setTimeout(updateStepPreview,300),setTimeout(function(){$(window).trigger("resize")},600),codeJSEditor.setValue(currentStep.settings.codeJS),$(".panel-right [name]").each(function(){var value,value;$(this).is('[type="checkbox"]')?(value=0,eval("value = currentStep.settings."+$(this).attr("name")+";"),value?$(this).attr("checked","checked"):$(this).removeAttr("checked")):(value="",eval("value = currentStep.settings."+$(this).attr("name")+";"),"text"==$(this).attr("name")&&(value=value.replace(/<br\/>/g,"\n"),value=value.replace(/<br \/>/g,"\n")),$(this).val(value),$(this).is("[data-slider]")&&$(this).next(".wutb_slider").slider("option","value",value))}),$(".panel-right [name]").trigger("change"),$("#stepButtonsTable tbody").html("");for(var i=0;i<currentStep.buttons.length;i++)addButtonRow(currentStep.buttons[i]);$('.panel-right  .panel-body .panel-tabs a[data-tab="settings"]').first().trigger("click")}}function openWinLicense(){$("#wutb_winLicense").modal("show"),""==$('#wutb_winLicense [name="purchaseCode"]').val()?$('#wutb_winLicense [name="purchaseCode"]').addClass("is-invalid"):$('#wutb_winLicense [name="purchaseCode"]').removeClass("is-invalid")}function verifyLicense(){var t=$('#wutb_winLicense [name="purchaseCode"]').val();$('#wutb_winLicense [name="purchaseCode"]').removeClass("is-invalid"),$.ajax({url:ajaxurl,type:"post",data:{action:"wutb_verifyPurchaseCode",purchaseCode:t},success:function(t){1!=t.trim()?($("#wutb_winLicense").modal("hide"),$('#wutb_winLicense [name="purchaseCode"]').removeClass("is-invalid")):($('#wutb_winLicense [name="purchaseCode"]').val(""),$('#wutb_winLicense [name="purchaseCode"]').addClass("is-invalid"))}})}function getStepByID(e){var n=!1;return $.each(currentTour.steps,function(t){this.id==e&&(n=this)}),n}function generateID(){return currentTour.indexID++,currentTour.indexID}function updateStepsDesign(){$("#wutb_stepsCanvas").attr("width",$("#wutb_stepsContainer").innerWidth()),$("#wutb_stepsCanvas").attr("height",$("#wutb_stepsContainer").innerHeight()-18),$("#wutb_stepsCanvas").css({width:$("#wutb_stepsContainer").outerWidth(),height:$("#wutb_stepsContainer").innerHeight()-18}),$(".wutb_stepBloc > .wutb_stepBlocWrapper > h4").each(function(){$(this).css("margin-top",0-$(this).height()/2)})}function linkLightStep(t){$('.wutb_stepBloc[data-stepid="'+t+'"]').addClass("linkLight"),setTimeout(function(){$('.wutb_stepBloc[data-stepid="'+t+'"]').removeClass("linkLight")},1e3)}function addConditionInteraction(t,e){var n=$('<tr class="wutb_conditionItem"></tr>'),a=$('<select class="wutb_conditionSelect form-control"></select>');a.append('<option value="currentURL">'+wutb_data.texts["Current URL"]+"</option>"),a.append('<option value="currentDate">'+wutb_data.texts["Current Date"]+"</option>"),a.append('<option value="wpUser">'+wutb_data.texts["Current WP user"]+"</option>");for(var o=0;o<currentTour.steps.length;o++)for(var i=currentTour.steps[o],r=0;r<i.buttons.length;r++){var l=i.buttons[r];a.append('<option value="btn_'+l.id+'">'+wutb_data.texts.Button+' "'+l.title+'"</option>')}var s=$('<select class="wutb_conditionoperatorSelect form-control"></select>');a.change(function(){s.find("option").remove(),a.val()&&"currentDate"==a.val()?(s.append('<option value="equals" data-variable="date">'+wutb_data.texts["Is equals to"]+"</option>"),s.append('<option value="different" data-variable="date">'+wutb_data.texts["Is different than"]+"</option>"),s.append('<option value="superior" data-variable="date">'+wutb_data.texts["Is superior to"]+"</option>"),s.append('<option value="inferior" data-variable="date">'+wutb_data.texts["Is inferior to"]+"</option>"),s.append('<option value="monthEquals" data-variable="month">'+wutb_data.texts["Is month equals to"]+"</option>"),s.append('<option value="monthDifferent" data-variable="month">'+wutb_data.texts["Is month different than"]+"</option>"),s.append('<option value="monthInferior" data-variable="month">'+wutb_data.texts["Is month inferior to"]+"</option>"),s.append('<option value="monthSuperior" data-variable="month">'+wutb_data.texts["Is month superior to"]+"</option>")):a.val()&&"currentURL"==a.val()?(s.append('<option value="equals" data-variable="text">'+wutb_data.texts["Is equals to"]+"</option>"),s.append('<option value="different" data-variable="text">'+wutb_data.texts["Is different than"]+"</option>"),s.append('<option value="contains" data-variable="text">'+wutb_data.texts.Contains+"</option>"),s.append('<option value="dontcontain" data-variable="text">'+wutb_data.texts["Does not Contain"]+"</option>")):a.val()&&"wpUser"==a.val()?(s.append('<option value="usernameIs" data-variable="text">'+wutb_data.texts["Username is"]+"</option>"),s.append('<option value="lastNameIs" data-variable="text">'+wutb_data.texts["Last name is"]+"</option>"),s.append('<option value="emailIs" data-variable="text">'+wutb_data.texts["Email is"]+"</option>"),s.append('<option value="roleIs" data-variable="text">'+wutb_data.texts["Role is"]+"</option>")):0==a.val().indexOf("btn_")&&(s.append('<option value="isSelected">'+wutb_data.texts["Is selected"]+"</option>"),s.append('<option value="isNotSelected">'+wutb_data.texts["Is not selected"]+"</option>")),0==s.children().length?s.slideUp():s.slideDown(),s.trigger("change")}),e&&(a.val(e.elementID),a.trigger("change")),s.change(function(){conditionsUpdateFields($(this))});var u=$("<td></td>");u.append(a),n.append(u);var c=$("<td></td>");c.append(s),n.append(c),n.append('<td></td><td><a href="javascript:" class="wutb_conditionDelBtn btn btn-circle btn-danger" ><span class="fas fa-trash"></span></a> </td>'),n.find(".wutb_conditionDelBtn").on("click",function(){conditionRemove(this)}),a.trigger("change"),e&&(s.val(e.action),s.change(),e.value&&s.closest(".wutb_conditionItem").find(".wutb_conditionValue").val(e.value),setTimeout(function(){conditionsUpdateFields(s,e),e.value&&s.closest(".wutb_conditionItem").find(".wutb_conditionValue").val(e.value)},500)),t.find("#wutb_conditionsTable tbody").append(n)}function conditionRemove(t){var e=$(t).closest(".wutb_conditionItem");e.slideUp(200),setTimeout(function(){e.remove()},230)}function conditionsUpdateFields(t,e){var n,a,o,i,r;t.closest(".wutb_conditionItem").find(".wutb_conditionValue").parent().remove(),t.closest(".wutb_conditionItem").find(".wutb_conditionValue").remove(),"text"==t.closest(".wutb_conditionItem").find(".wutb_conditionoperatorSelect option:selected").attr("data-variable")&&0==t.closest(".wutb_conditionItem").find(".wutb_conditionValue").length&&t.closest(".wutb_conditionItem").children("td:eq(2)").html('<div><input type="text" placeholder="'+wutb_data.texts["My text here"]+'" class="wutb_conditionValue form-control" /> </div>'),"number"==t.closest(".wutb_conditionItem").find(".wutb_conditionoperatorSelect option:selected").attr("data-variable")&&0==t.closest(".wutb_conditionItem").find(".wutb_conditionValue").length&&(t.closest(".wutb_conditionItem").children("td:eq(2)").html('<div><input type="number" value="0" class="wutb_conditionValue form-control" /> </div>'),t.closest(".wutb_conditionItem").children("td:eq(2)").find("input").focus()),"date"==t.closest(".wutb_conditionItem").find(".wutb_conditionoperatorSelect option:selected").attr("data-variable")&&0==t.closest(".wutb_conditionItem").find(".wutb_conditionValue").length&&(t.closest(".wutb_conditionItem").children("td:eq(2)").html('<div><input type="text" step="any" class="wutb_conditionValue form-control"/> </div>'),t.closest(".wutb_conditionItem").find(".wutb_conditionValue").datepicker({dateFormat:"yy-mm-dd"})),"month"==t.closest(".wutb_conditionItem").find(".wutb_conditionoperatorSelect option:selected").attr("data-variable")&&0==t.closest(".wutb_conditionItem").find(".wutb_conditionValue").length&&(t.closest(".wutb_conditionItem").children("td:eq(2)").html('<div><input type="text" step="any" class="wutb_conditionValue form-control"/> </div>'),t.closest(".wutb_conditionItem").find(".wutb_conditionValue").datepicker({dateFormat:"mm"})),"select"==t.closest(".wutb_conditionItem").find(".wutb_conditionoperatorSelect option:selected").attr("data-variable")&&(n=t.closest(".wutb_conditionItem").find(".wutb_conditionSelect"),a=n.val().substr(0,n.val().indexOf("_")),o=n.val().substr(n.val().indexOf("_")+1,n.val().length),i="",$.each(currentTour.steps,function(){this.id==a&&$.each(this.items,function(){this.id==o&&(i=this.optionsValues)})}),r=i.split("|"),$.each(r,function(){var t=this;0<t.indexOf(";;")&&(t=t.split(";;")[0]),0<t.length&&(i+='<option value="'+t+'">'+t+"</option>")}),0==t.closest(".wutb_conditionItem").find(".wutb_conditionValue").length&&t.closest(".wutb_conditionItem").children("td:eq(2)").html('<div><select class="wutb_conditionValue form-control">'+i+"</select></div>")),e&&e.value&&t.closest(".wutb_conditionItem").find(".wutb_conditionValue").val(e.value)}function getTextFromBool(t){return t?wutb_data.texts.Yes:wutb_data.texts.No}function getEditedStepData(){var rep={tourID:currentTour.id,texts_font:currentTour.settings.texts_font,tooltip_font:currentTour.settings.tooltip_font,arrow_font:currentTour.settings.arrow_font,dialog_font:currentTour.settings.dialog_font};return $(".panel-right [name]").each(function(){var value="",value=$(this).is('[type="checkbox"]')?$(this).is(":checked"):nl2br($(this).val());eval("rep."+$(this).attr("name")+"=value;")}),rep}function updateStepPreview(t){var e;iframeLoaded&&((e=getEditedStepData()).mode="preview",void 0!==t&&t&&(e.enableEntry=!0),$("body",$("#wutb_elementSelectionFrame").contents()).is(".wutb_frontend")&&($("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("previewStepData",e),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewAction","updateStepPreview"),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewValue",{mode:"preview",buttons:currentStep.buttons,settings:getEditedStepData()}),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").trigger("wutb_triggerAction")))}function startSelectElement(){currentStep?$("#wutb_elementSelectionFrame").data("action","selectStepElement"):$("#wutb_elementSelectionFrame").data("action","selectStartElement"),$("#wutb_elementSelectionPanel").fadeIn(),selectionInProgress=!0,$("#wutb_stepContainer").fadeOut(),wpMenuWasOpen=!!$("#collapse-button").is('[aria-expanded="true"]'),$("#wpwrap").addClass("wutb_hideWPMenu"),layoutPanel.closePanel($(".panel-right"),layoutPanel),layoutPanel.closePanel($(".panel-bottom"),layoutPanel),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewAction","startElementSelection"),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewValue",""),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").trigger("wutb_triggerAction");var t=wutb_data.texts.Backend,e="fas fa-user-lock";0==$("#wutb_elementSelectionFrame").get(0).contentWindow.location.href.indexOf(wutb_data.adminUrl)&&(t=wutb_data.texts.Frontend,e="fas fa-users"),$(".panel-center").notification({html:wutb_data.texts["Navigate to the desired page and click the button below to select the desired item."],style:"primary",autoClose:!1,id:"notice_startElementSelection",onShow:function(){$("#notice_startElementSelection").resizable({handles:"s"})},onClose:stopElementSelection,buttons:[{icon:e,label:t,style:"dark",click:function(){$("#wutb_elementSelectionFrame").data("action","selectStartElement");var t=wutb_data.adminUrl;0==$("#wutb_elementSelectionFrame").get(0).contentWindow.location.href.indexOf(wutb_data.adminUrl)&&(t=wutb_data.siteUrl),$("#wutb_frameLoader").fadeIn(),$("#wutb_elementSelectionFrame").attr("src",t)}},{icon:e,label:wutb_data.texts["Select an element"],style:"light",click:continueSelectElement}]})}function continueSelectElement(){$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewAction","continueElementSelection"),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewValue",""),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").trigger("wutb_triggerAction"),$(".panel-center").notification({html:wutb_data.texts["Click the target element in the page"],style:"primary",autoClose:!1,id:"notice_continueElementSelection",onClose:stopElementSelection,onShow:function(){$("#notice_continueElementSelection").resizable({handles:"s"})},buttons:[{icon:"fas fa-times",label:wutb_data.texts.Cancel,style:"light",click:startSelectElement}]})}function stopElementSelection(){selectionInProgress=!1,$("#wpwrap").removeClass("wutb_hideWPMenu"),$("#wutb_elementSelectionFrame").data("action",""),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewAction","stopElementSelection"),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewValue",""),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").trigger("wutb_triggerAction"),currentStep?(layoutPanel.showPanel($(".panel-right"),layoutPanel),updateStepPreview()):layoutPanel.showPanel($(".panel-bottom"),layoutPanel),$("#wutb_elementSelectionPanel").fadeOut()}function validElementSelection(t){selectionInProgress=!1,$("#notice_continueElementSelection").fadeOut(),setTimeout(function(){$("#notice_continueElementSelection").remove(),$(".panel-center").notification({html:wutb_data.texts["Do you want to select this element ?"],style:"primary",autoClose:!1,id:"notice_validElementSelection",onClose:stopElementSelection,buttons:[{icon:"fas fa-check",label:wutb_data.texts.Yes,style:"light",click:function(){confirmSelectElement(t)}},{icon:"fas fa-times",label:wutb_data.texts.No,style:"dark",click:continueSelectElement}]})},500)}function confirmSelectElement(t){currentStep?($('.panel-right [name="url"]').val($("#wutb_elementSelectionFrame").get(0).contentWindow.location.href).trigger("change"),$('.panel-right [name="domElement"]').val(getElementPath(t)).trigger("change"),layoutPanel.showPanel($(".panel-right"),layoutPanel),setTimeout(updateStepPreview,300),setTimeout(function(){$(window).trigger("resize")},600),updateStepPreview()):($('.panel-bottom [name="tourDomElement"]').val(getElementPath(t)).trigger("change"),$("#wutb_elementSelectionPanel").fadeOut(),layoutPanel.showPanel($(".panel-bottom"),layoutPanel)),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewAction","confirmElementSelection"),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewValue",""),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").trigger("wutb_triggerAction"),$("#wpwrap").removeClass("wutb_hideWPMenu")}function getElementPath(t){var e="";return 0<jQuery(t).length&&void 0!==jQuery(t).prop("tagName")&&(jQuery(t).attr("id")&&"ultimate-"!=jQuery(t).attr("id").substr(0,9)?e+="#"+jQuery(t).attr("id"):(e=">"+jQuery(t).prop("tagName")+":nth-child("+(jQuery(t).index()+1)+")"+e,e=getElementPath(jQuery(t).parent())+e)),e}function closeStepEdition(){tourModified=!0,layoutPanel.closePanel($(".panel-right"),layoutPanel),$(".panel-bottom").removeClass("hidden"),$(".wutb-notification").remove(),$("body",$("#wutb_elementSelectionFrame").contents()).is(".wutb_frontend")&&($("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewAction","stopElementSelection"),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewValue",""),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").trigger("wutb_triggerAction"));var stepData=currentStep.settings;$("#wpwrap").removeClass("wutb_hideWPMenu"),$(".panel-right [name]").each(function(){var value="",value=$(this).is('[type="checkbox"]')?$(this).is(":checked")?1:0:$(this).val();eval("currentStep.settings."+$(this).attr("name")+"=value;")}),stepData.codeJS=codeJSEditor.getValue(),$("#wutb_elementSelectionPanel").fadeOut(),$("#wutb_stepManagerPanel").fadeIn(),$(".panel-top [data-tab]").hide(),$('.panel-top [data-tab="tour"]').show(),$('.wutb_stepBloc[data-stepid="'+currentStep.id+'"] h4').html(stepData.title),currentStep=!1,currentStepIndex=0,updateStepsDesign()}function saveTour(e){sessionStorage.removeItem("wutb_viewedTour_"+currentTour.id),tourModified=!1,$.ajax({url:ajaxurl,type:"post",data:{action:"wutb_saveTour",tourID:currentTour.id,tourData:JSON.stringify(currentTour)},success:function(t){$(".panel-center").notification({html:wutb_data.texts["The tour was correctly saved"],style:"primary"}),"function"==typeof e&&e()}})}function updateEditedStepData(){currentStep.settings=getEditedStepData()}function startSelectUrl(){layoutPanel.closePanel($(".panel-right"),layoutPanel),layoutPanel.closePanel($(".panel-bottom"),layoutPanel),wpMenuWasOpen=!!$("#collapse-button").is('[aria-expanded="true"]'),$("#wpwrap").addClass("wutb_hideWPMenu"),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewAction","startPageSelection"),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("wutb_lastPreviewValue",""),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").trigger("wutb_triggerAction");var t=wutb_data.texts.Backend,e="fas fa-user-lock";0==$("#wutb_elementSelectionFrame").get(0).contentWindow.location.href.indexOf(wutb_data.adminUrl)&&(t=wutb_data.texts.Frontend,e="fas fa-users"),$(".panel-center").notification({html:wutb_data.texts["Navigate to the desired page then click the button below to select it."],style:"primary",autoClose:!1,id:"notice_startPageSelection",onClose:stopElementSelection,buttons:[{icon:e,label:t,style:"dark",click:function(){$("#wutb_elementSelectionFrame").data("action","selectPage");var t=wutb_data.adminUrl;0==$("#wutb_elementSelectionFrame").get(0).contentWindow.location.href.indexOf(wutb_data.adminUrl)&&(t=wutb_data.siteUrl),$("#wutb_frameLoader").fadeIn(),$("#wutb_elementSelectionFrame").attr("src",t)}},{icon:"fas fa-hand-point-up",label:wutb_data.texts["Select this page"],style:"light",click:validSelectPage}]})}function validSelectPage(){"step"==selectUrlMode?($('.panel-right [name="url"]').val($("#wutb_elementSelectionFrame").get(0).contentWindow.location.href).trigger("change"),updateStepPreview(),layoutPanel.showPanel($(".panel-right"),layoutPanel)):($("#wutb_elementSelectionPanel").fadeOut(),$('#wutb_bottomSettings [name="startURL"]').val($("#wutb_elementSelectionFrame").get(0).contentWindow.location.href).trigger("change"),layoutPanel.showPanel($(".panel-bottom"),layoutPanel)),$("#wpwrap").removeClass("wutb_hideWPMenu")}function createNewButton(){$("#wutb_mainPanel > .tooltip").remove();var t={id:generateID(),title:wutb_data.texts["My button"],icon:"fas fa-check",finalPage:"",action:"nextStep",backgroundColor:"#1abc9c",textColor:"#ffffff"};currentStep.buttons.push(t),addButtonRow(t),updateStepPreview()}function addButtonRow(t){var e=$('<tr data-id="'+t.id+'"><td>'+t.title+'</td><td class="text-right"><a href="javascript:" class="btn btn-primary btn-circle" data-action="editButton"><span class="fas fa-pencil-alt"></span></a><a href="javascript:" data-action="deleteButton" class="btn btn-danger btn-circle"><span class="fas fa-trash"></span></a></td></tr>');$("#stepButtonsTable tbody").append(e),e.find('a[data-action="editButton"]').on("click",function(){editButton($(this).closest("tr").attr("data-id"))}),e.find('a[data-action="deleteButton"]').on("click",function(){deleteButton($(this).closest("tr").attr("data-id"))})}function getButtonByID(t){for(var e=!1,n=0;n<currentStep.buttons.length;n++)currentStep.buttons[n].id==t&&(e=currentStep.buttons[n]);return e}function editButton(btnID){var btn=getButtonByID(btnID);btn&&($("#wutb_winEditButton [name]").each(function(){var value;$(this).is('[type="checkbox"]')?(value=0,eval("value = btn."+$(this).attr("name")+";"),value?$(this).attr("checked","checked"):$(this).removeAttr("checked")):eval("$(this).val(btn."+$(this).attr("name")+').trigger("change");')}),$("#wutb_winEditButton").data("buttonID",btnID),$("#wutb_winEditButton").modal("show"))}function deleteButton(e){currentStep.buttons=$.grep(currentStep.buttons,function(t){return t.id!=e}),$('#stepButtonsTable tbody tr[data-id="'+e+'"]').remove(),updateStepPreview()}function saveButton(){var btnID=$("#wutb_winEditButton").data("buttonID"),btn=getButtonByID(btnID);btn&&$("#wutb_winEditButton [name]").each(function(){eval("btn."+$(this).attr("name")+"= $(this).val();")}),$('#stepButtonsTable [data-id="'+btn.id+'"]').find("td").first().html(btn.title),$("#wutb_winEditButton").modal("hide"),updateStepPreview()}function previewTourByID(n){$.ajax({url:ajaxurl,type:"post",data:{action:"wutb_previewTourByID",tourID:n},success:function(t){var e=wutb_data.siteUrl+t;-1<e.indexOf("?")?e+="&tourPreview="+n:e+="?tourPreview="+n,window.open(e,"_blank").focus()}})}function previewTour(){$.ajax({url:ajaxurl,type:"post",data:{action:"wutb_previewTour",tourID:currentTour.id,tourData:JSON.stringify(currentTour)},success:function(t){var e=wutb_data.siteUrl;-1<(e+=currentTour.settings.startURL).indexOf("?")?e+="&tourPreview="+currentTour.id:e+="?tourPreview="+currentTour.id,window.open(e,"_blank").focus()}})}function askSaveBeforeLeave(t){$(".panel-center").notification({html:wutb_data.texts["Do you want to save the tour before leaving ?"],style:"primary",autoClose:!1,id:"notice_saveBeforeLeave",buttons:[{icon:"fa-save",label:wutb_data.texts.Yes,style:"light",click:function(){saveTour(function(){window.document.location.href=t})}},{icon:"fa-times",label:wutb_data.texts.No,style:"dark",click:function(){window.document.location.href=t}}]})}function updateTourSettings(){$("#wutb_bottomSettings [name]").each(function(){var value="",value=$(this).is('[type="checkbox"]')?$(this).is(":checked"):nl2br($(this).val());eval("currentTour.settings."+$(this).attr("name")+"=value;")})}function updateStepSetting(t){var e=!1,n=t.attr("name");t.is('[type="checkbox"]')?e=t.is(":checked"):t.is(".wutb_slider")?(e=t.slider("value"),n=t.attr("data-name")):e=t.val(),"text"==t.attr("name")&&(e=e.replace(/\n/g,"<br/>")),$("body",$("#wutb_elementSelectionFrame").contents()).is(".wutb_frontend")&&($("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("lastSettingKey",n),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").data("lastSettingValue",e),$("#wutb_elementSelectionFrame")[0].contentWindow.jQuery("body").trigger("triggerUpdateStepSetting"))}function askDeleteTour(t){$(".panel-center").notification({html:wutb_data.texts["Do you want to delete this tour ?"],style:"primary",autoClose:!1,id:"notice_deleteTour",onClose:stopElementSelection,buttons:[{icon:"fas fa-check",label:wutb_data.texts.Yes,style:"light",click:function(){deleteTour(t)}},{icon:"fas fa-times",label:wutb_data.texts.No,style:"dark"}]})}function askDeleteStep(t){$(".panel-center").notification({html:wutb_data.texts["Do you want to delete this step ?"],style:"primary",autoClose:!1,id:"notice_deleteStep",onClose:stopElementSelection,buttons:[{icon:"fas fa-check",label:wutb_data.texts.Yes,style:"light",click:function(){removeStep(t)}},{icon:"fas fa-times",label:wutb_data.texts.No,style:"dark"}]})}function showLoader(){$("#wutb_mainPanel > .tooltip").remove(),$("#wutb_loader").fadeIn()}function hideLoader(){$("#wutb_loader").fadeOut()}function exportTours(){showLoader(),jQuery.ajax({url:ajaxurl,type:"post",data:{action:"wutb_exportTours"},success:function(t){hideLoader(),"1"==t?jQuery("#wutb_winExport").modal("show"):alert(wutb_data.texts.errorExport)}})}function importTours(){$("#wutb_winImport").modal("show")}function importToursJson(){showLoader(),jQuery("#wutb_winImport").modal("hide");var t=new FormData(jQuery("#wutb_winImportForm")[0]);jQuery.ajax({url:ajaxurl,type:"post",xhr:function(){return jQuery.ajaxSettings.xhr()},success:function(t){"1"!=t?(hideLoader(),alert(wutb_data.texts.errorImport)):document.location.href},data:t,cache:!1,contentType:!1,processData:!1})}wutb_data=wutb_data[0],$(document).on("ready",function(){$("body").on("wutb_elementSelected",elementSelected),initUI(),initGlobalListeners(),initStepSettings(),initSettingsListeners(),initMenusListeners(),initStepListeners(),initButtonListeners(),$("#wutb_loader").fadeOut(250),setTimeout(function(){$(window).trigger("resize")},300),showFirstStartPanel()})}(jQuery);